<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocolandia v6.0.0 - Final</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',      // Fondo
                        panel: '#1e293b',     // Tarjetas
                        header: '#263345',    // Cabecera Tabla
                        primary: '#6366f1',   // Indigo
                        success: '#10b981',   // Verde
                        danger: '#ef4444'     // Rojo
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        
        /* Animaciones */
        .fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .toast { transition: all 0.3s ease; transform: translateX(100%); opacity: 0; }
        .toast.show { transform: translateX(0); opacity: 1; }

        /* Scrollbar discreto */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="bg-dark text-slate-300 h-screen w-screen overflow-hidden flex select-none">

    <aside class="w-64 bg-panel border-r border-slate-700/50 flex flex-col justify-between shrink-0 z-20">
        <div class="p-5">
            <div class="flex items-center gap-3 mb-10">
                <div class="bg-gradient-to-br from-indigo-500 to-purple-600 p-2.5 rounded-xl text-white shadow-lg shadow-indigo-500/20">
                    <i class="fa-solid fa-store"></i>
                </div>
                <div>
                    <h1 class="font-bold text-white text-lg leading-tight">Cocolandia</h1>
                    <div class="text-[10px] text-slate-500 font-mono flex items-center gap-2">
                        v6.0.0 <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                    </div>
                </div>
            </div>

            <nav class="space-y-1">
                <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-slate-700/50 transition group">
                    <i class="fa-solid fa-cash-register w-5 text-center text-slate-400 group-hover:text-white"></i> Caja
                </a>
                <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-slate-700/50 transition group">
                    <i class="fa-solid fa-users w-5 text-center text-slate-400 group-hover:text-white"></i> Clientes
                </a>
                <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-slate-700/50 transition group">
                    <i class="fa-solid fa-boxes-stacked w-5 text-center text-slate-400 group-hover:text-white"></i> Inventario
                </a>
                
                <div class="my-4 border-t border-slate-700/50"></div>
                <div class="px-3 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2">Administración</div>
                
                <a href="#" class="flex items-center gap-3 p-3 rounded-lg bg-indigo-500/10 text-primary border border-primary/20 font-medium shadow-sm">
                    <i class="fa-solid fa-user-gear w-5 text-center"></i> Usuarios
                </a>
            </nav>
        </div>
        
        <div class="p-4 border-t border-slate-700/50">
            <button class="w-full flex items-center justify-center gap-2 p-2.5 rounded-lg text-danger hover:bg-danger/10 transition text-sm font-semibold">
                <i class="fa-solid fa-power-off"></i> Salir
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full bg-dark relative z-10">
        <header class="p-8 pb-0 flex justify-between items-end mb-8">
            <div>
                <h2 class="text-3xl font-bold text-white tracking-tight">Gestión de Usuarios</h2>
                <p class="text-slate-500 mt-1 text-sm">Administra roles y permisos del sistema POS.</p>
            </div>
            <button onclick="app.modal(true)" class="bg-primary hover:bg-indigo-500 text-white px-5 py-2.5 rounded-lg font-bold shadow-lg shadow-indigo-500/20 transition flex items-center gap-2 active:scale-95">
                <i class="fa-solid fa-plus"></i> Nuevo Usuario
            </button>
        </header>

        <div class="px-8 pb-6 flex gap-4">
            <div class="relative flex-1 max-w-md">
                <i class="fa-solid fa-magnifying-glass absolute left-3.5 top-3 text-slate-500 text-sm"></i>
                <input type="text" id="search" onkeyup="app.render()" placeholder="Buscar por nombre, usuario..." 
                    class="w-full bg-panel border border-slate-700 rounded-lg py-2.5 pl-10 pr-4 text-white text-sm outline-none focus:border-primary focus:ring-1 focus:ring-primary transition placeholder-slate-600">
            </div>
            <select id="filterRole" onchange="app.render()" class="bg-panel border border-slate-700 rounded-lg px-4 text-white text-sm outline-none focus:border-primary cursor-pointer">
                <option value="">Todos los Roles</option>
                <option value="ADMIN">Administradores</option>
                <option value="CAJERO">Cajeros</option>
                <option value="ALMACEN">Almacén</option>
            </select>
        </div>

        <div class="flex-1 px-8 pb-8 overflow-hidden">
            <div class="bg-panel rounded-xl border border-slate-700 shadow-xl h-full flex flex-col">
                <div class="overflow-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-header text-slate-400 text-xs uppercase font-semibold sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th class="px-6 py-4">Usuario</th>
                                <th class="px-6 py-4">Nombre Completo</th>
                                <th class="px-6 py-4">Rol</th>
                                <th class="px-6 py-4">Estado</th>
                                <th class="px-6 py-4 text-right">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-slate-700/50 text-sm">
                            </tbody>
                    </table>
                    
                    <div id="empty" class="hidden flex flex-col items-center justify-center h-64 text-slate-500">
                        <div class="bg-dark p-4 rounded-full mb-3"><i class="fa-solid fa-ghost text-3xl opacity-50"></i></div>
                        <p>No se encontraron resultados.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="modalOverlay" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-panel w-full max-w-md rounded-xl border border-slate-600 shadow-2xl fade-in">
            <div class="px-6 py-5 border-b border-slate-700 flex justify-between items-center bg-header/50 rounded-t-xl">
                <h3 id="modalTitle" class="text-white font-bold text-lg">Nuevo Usuario</h3>
                <button onclick="app.modal(false)" class="text-slate-400 hover:text-white transition"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            
            <form onsubmit="app.save(event)" class="p-6 space-y-4">
                <input type="hidden" id="uid">
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1.5">Usuario</label>
                        <input type="text" id="uUser" required class="w-full bg-dark border border-slate-600 rounded-lg p-2.5 text-white outline-none focus:border-primary transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1.5">Rol</label>
                        <select id="uRole" class="w-full bg-dark border border-slate-600 rounded-lg p-2.5 text-white outline-none focus:border-primary transition">
                            <option value="CAJERO">Cajero</option>
                            <option value="ADMIN">Admin</option>
                            <option value="ALMACEN">Almacén</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1.5">Nombre Completo</label>
                    <input type="text" id="uName" required class="w-full bg-dark border border-slate-600 rounded-lg p-2.5 text-white outline-none focus:border-primary transition">
                </div>

                <div class="bg-dark/50 p-3 rounded-lg border border-slate-700/50 flex items-center gap-3 cursor-pointer" onclick="document.getElementById('uActive').click()">
                    <input type="checkbox" id="uActive" class="w-4 h-4 text-primary rounded bg-panel border-slate-600 focus:ring-offset-0 focus:ring-0">
                    <span class="text-sm font-medium text-white">Usuario Activo</span>
                </div>

                <div class="pt-2 flex gap-3">
                    <button type="button" onclick="app.modal(false)" class="flex-1 bg-slate-700 text-white py-2.5 rounded-lg hover:bg-slate-600 transition font-medium">Cancelar</button>
                    <button type="submit" class="flex-1 bg-primary text-white py-2.5 rounded-lg hover:bg-indigo-500 transition font-bold shadow-lg shadow-indigo-500/20">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toastContainer" class="fixed bottom-6 right-6 z-[60] flex flex-col gap-2 pointer-events-none"></div>

    <script>
        const app = {
            data: [],
            
            init() {
                const db = localStorage.getItem('cocolandia_v600');
                if (db) {
                    this.data = JSON.parse(db);
                } else {
                    this.data = [
                        { id: 1, user: 'admin', name: 'Administrador', role: 'ADMIN', active: true },
                        { id: 2, user: 'cajero1', name: 'Roberto Gómez', role: 'CAJERO', active: true },
                        { id: 3, user: 'bodega', name: 'Laura Torres', role: 'ALMACEN', active: false }
                    ];
                    this.persist();
                }
                this.render();
            },

            persist() {
                localStorage.setItem('cocolandia_v600', JSON.stringify(this.data));
            },

            // --- UI ---
            render() {
                const text = document.getElementById('search').value.toLowerCase();
                const roleFilter = document.getElementById('filterRole').value;
                const tbody = document.getElementById('tableBody');
                
                tbody.innerHTML = '';

                const list = this.data.filter(u => {
                    const matchText = u.user.toLowerCase().includes(text) || u.name.toLowerCase().includes(text);
                    const matchRole = roleFilter === '' || u.role === roleFilter;
                    return matchText && matchRole;
                });

                if (list.length === 0) {
                    document.getElementById('empty').classList.remove('hidden');
                } else {
                    document.getElementById('empty').classList.add('hidden');
                    
                    list.forEach(u => {
                        // Badge Styles
                        let badge = "bg-slate-700 text-slate-300";
                        if(u.role === 'ADMIN') badge = "bg-indigo-500/10 text-indigo-400 border border-indigo-500/20";
                        if(u.role === 'ALMACEN') badge = "bg-orange-500/10 text-orange-400 border border-orange-500/20";

                        // Status
                        const status = u.active 
                            ? `<span class="inline-flex items-center gap-1.5 px-2 py-1 rounded bg-emerald-500/10 text-emerald-400 text-xs font-bold border border-emerald-500/10"><span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span> ACTIVO</span>`
                            : `<span class="inline-flex items-center gap-1.5 px-2 py-1 rounded bg-slate-700/50 text-slate-500 text-xs font-bold"><span class="w-1.5 h-1.5 rounded-full bg-slate-500"></span> INACTIVO</span>`;

                        // Avatar Initials
                        const initials = u.name.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
                        const avatarColor = u.role === 'ADMIN' ? 'bg-indigo-600' : 'bg-slate-600';

                        const tr = document.createElement('tr');
                        tr.className = "hover:bg-slate-700/30 transition group border-b border-slate-700/50 last:border-0";
                        tr.innerHTML = `
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-9 h-9 rounded-lg ${avatarColor} flex items-center justify-center text-white text-xs font-bold shadow-md">${initials}</div>
                                    <div>
                                        <div class="font-bold text-white text-sm">${u.user}</div>
                                        <div class="text-[10px] text-slate-500">ID: ${u.id}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-slate-300">${u.name}</td>
                            <td class="px-6 py-4"><span class="px-2 py-1 rounded text-[10px] font-bold tracking-wider ${badge}">${u.role}</span></td>
                            <td class="px-6 py-4">${status}</td>
                            <td class="px-6 py-4 text-right">
                                <button onclick="app.edit(${u.id})" class="text-slate-400 hover:text-white hover:bg-slate-600 p-2 rounded transition mr-1"><i class="fa-solid fa-pen"></i></button>
                                <button onclick="app.del(${u.id})" class="text-slate-400 hover:text-danger hover:bg-red-500/10 p-2 rounded transition"><i class="fa-solid fa-trash"></i></button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
            },

            // --- CRUD ---
            modal(show) {
                const el = document.getElementById('modalOverlay');
                if (show) {
                    el.classList.remove('hidden');
                    document.getElementById('uid').value = '';
                    document.getElementById('uUser').value = '';
                    document.getElementById('uName').value = '';
                    document.getElementById('uActive').checked = true;
                    document.getElementById('modalTitle').innerText = 'Nuevo Usuario';
                } else {
                    el.classList.add('hidden');
                }
            },

            edit(id) {
                const u = this.data.find(x => x.id === id);
                if(u) {
                    this.modal(true);
                    document.getElementById('modalTitle').innerText = 'Editar Usuario';
                    document.getElementById('uid').value = u.id;
                    document.getElementById('uUser').value = u.user;
                    document.getElementById('uName').value = u.name;
                    document.getElementById('uRole').value = u.role;
                    document.getElementById('uActive').checked = u.active;
                }
            },

            save(e) {
                e.preventDefault();
                const id = document.getElementById('uid').value;
                const user = {
                    id: id ? parseInt(id) : (this.data.length ? Math.max(...this.data.map(u => u.id)) + 1 : 101),
                    user: document.getElementById('uUser').value,
                    name: document.getElementById('uName').value,
                    role: document.getElementById('uRole').value,
                    active: document.getElementById('uActive').checked
                };

                if (id) {
                    const idx = this.data.findIndex(x => x.id == id);
                    if(idx !== -1) this.data[idx] = user;
                    this.toast('Usuario actualizado correctamente', 'success');
                } else {
                    this.data.push(user);
                    this.toast('Nuevo usuario creado', 'success');
                }
                
                this.persist();
                this.render();
                this.modal(false);
            },

            del(id) {
                if(confirm('¿Eliminar usuario del sistema?')) {
                    this.data = this.data.filter(u => u.id !== id);
                    this.persist();
                    this.render();
                    this.toast('Usuario eliminado', 'danger');
                }
            },

            // --- NOTIFICACIONES ---
            toast(msg, type = 'success') {
                const container = document.getElementById('toastContainer');
                const div = document.createElement('div');
                const colors = type === 'success' ? 'bg-emerald-600' : 'bg-red-600';
                const icon = type === 'success' ? 'fa-check' : 'fa-trash';
                
                div.className = `toast flex items-center gap-3 ${colors} text-white px-4 py-3 rounded-lg shadow-xl min-w-[300px] border border-white/10`;
                div.innerHTML = `<i class="fa-solid ${icon}"></i> <span class="font-medium text-sm">${msg}</span>`;
                
                container.appendChild(div);
                
                // Trigger animation
                requestAnimationFrame(() => div.classList.add('show'));
                
                setTimeout(() => {
                    div.classList.remove('show');
                    setTimeout(() => div.remove(), 300);
                }, 3000);
            }
        };

        // Iniciar App
        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
